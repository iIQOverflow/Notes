# Lecture2
400=1k

BOOTSEG=07C0

bootsect.s将扇区分批地拷贝进去，

关掉中断，覆盖中断向量，设置GDTR（全局描述符表寄存器）和IDTR（中断描述符表寄存器）

GDTR描述的是段，基于段的特权级，支撑进程，非常重要。GDTR指向的才是全局描述符，

20条总线变成32位的，先打开A20

P24   可以单独打开PE，也可以打开PE，然后打开分页，但是不允许只打开分页。

线性地址：CPU可寻找的地址。

lmsw 装机器状态字

保护模式打开后，段不能用CS，只能用GDT，中断用IDT

注意此时中断已经关掉！

`jmpi	0,8		! jmp offset 0 of segment 8 (cs)`

8代表`1000`，内核特权级
00 pl特权级

0代表GDT，1代表LDT，

1GDT或LDT的第几项

1是内核代码段（1），2是内核数据段（10）

0x17 3特权，用户，内核数据段。

0x8 0特权，内核代码段

作用：从setup程序跳到head程序的第一行

`movl $0x10,%eax`0特权，GDT，内核数据段

`lss _stack_start,%esp`汇编首字符是下划线的把下划线去掉通常是C语言里的标识符，汇编比C多一个下划线。

查IA32特权级：CPL、DPL

物理内存：16Mb，打开PE后可寻址内存为4G

把main函数地址压进去，head.s执行完就执行kernel的main函数

`setup_paging`开始分页，head.s最后的工作，内核分页。

页目录表和页表都占一个页，大小4k。这是intel的规则。
一个页目录表占1024项，页表同。一个页目录表可以管

一个32位的地址空间一个页目录表就够了。

16M需要一个页目录表，4个页表。

线性地址和物理地址正好一样。

cr0 打开PE
cr3 盯着页目录表

打开PG